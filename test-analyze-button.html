<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Bot√£o Analisar - SADE</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        .btn-purple { background-color: #7c3aed; border-color: #7c3aed; color: white; }
        .btn-purple:hover { background-color: #6d28d9; border-color: #6d28d9; color: white; }
    </style>
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4><i class="fas fa-bug me-2"></i>Teste Bot√£o Analisar</h4>
                    </div>
                    <div class="card-body">
                        <form id="testForm">
                            <div class="row g-3 mb-4">
                                <div class="col-md-4">
                                    <label class="form-label fw-bold">Ano Escolar</label>
                                    <select id="anoEscolar" class="form-select" required>
                                        <option value="">Selecione o ano</option>
                                        <option value="6">6¬∫ ano</option>
                                        <option value="7">7¬∫ ano</option>
                                        <option value="8">8¬∫ ano</option>
                                        <option value="9">9¬∫ ano</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-bold">Disciplina</label>
                                    <select id="disciplina" class="form-select" required>
                                        <option value="">Selecione a disciplina</option>
                                        <option value="L√≠ngua Portuguesa - Leitura">L√≠ngua Portuguesa</option>
                                        <option value="Matem√°tica">Matem√°tica</option>
                                        <option value="Ci√™ncias da Natureza">Ci√™ncias da Natureza</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-bold">Escola</label>
                                    <input type="text" id="escola" class="form-control" placeholder="Nome da escola" required>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label class="form-label fw-bold">Arquivo da Prova</label>
                                <input type="file" id="fileInput" class="form-control" accept=".pdf,.doc,.docx,.txt" required>
                            </div>

                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-purple btn-lg" id="analyzeBtn">
                                    <i class="fas fa-magic me-2"></i>Analisar Prova
                                </button>
                                
                                <button type="button" class="btn btn-outline-primary" onclick="testAnalysis()">
                                    <i class="fas fa-bug me-2"></i>Teste Direto
                                </button>
                                
                                <button type="button" class="btn btn-outline-success" onclick="validateForm()">
                                    <i class="fas fa-check me-2"></i>Validar Formul√°rio
                                </button>
                            </div>
                        </form>
                        
                        <div id="results" class="mt-4" style="display: none;">
                            <div class="alert alert-success">
                                <h5><i class="fas fa-check-circle me-2"></i>An√°lise Conclu√≠da!</h5>
                                <p id="resultText"></p>
                            </div>
                        </div>
                        
                        <div id="log" class="mt-3">
                            <h6>Log de Debug:</h6>
                            <div id="debugLog" class="border p-2 bg-light" style="height: 300px; overflow-y: auto; font-family: monospace; font-size: 12px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Modal -->
    <div class="modal fade" id="loadingModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center p-4">
                    <div class="spinner-border text-primary mb-3" role="status">
                        <span class="visually-hidden">Carregando...</span>
                    </div>
                    <h5 id="loadingTitle">Processando...</h5>
                    <p class="text-muted mb-0" id="loadingMessage">Analisando dados</p>
                    <small class="text-muted" id="loadingDetails"></small>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Debug log function
        function log(message) {
            const debugLog = document.getElementById('debugLog');
            const time = new Date().toLocaleTimeString();
            debugLog.innerHTML += `[${time}] ${message}<br>`;
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(message);
        }

        // Fun√ß√£o de teste direto
        function testAnalysis() {
            log('üß™ Teste direto iniciado');
            
            // Preencher formul√°rio automaticamente
            document.getElementById('anoEscolar').value = '6';
            document.getElementById('disciplina').value = 'L√≠ngua Portuguesa - Leitura';
            document.getElementById('escola').value = 'Escola Teste';
            
            log('üìù Formul√°rio preenchido automaticamente');
            
            // Simular an√°lise
            showResults('Teste direto conclu√≠do! An√°lise simulada com 25 quest√µes.');
        }

        // Validar formul√°rio
        function validateForm() {
            log('üîç Validando formul√°rio...');
            
            const ano = document.getElementById('anoEscolar').value;
            const disciplina = document.getElementById('disciplina').value;
            const escola = document.getElementById('escola').value;
            const arquivo = document.getElementById('fileInput').files[0];
            
            log(`üìä Dados coletados: ano=${ano}, disciplina=${disciplina}, escola=${escola}, arquivo=${arquivo ? arquivo.name : 'nenhum'}`);
            
            let isValid = true;
            
            if (!ano) {
                log('‚ùå Ano escolar n√£o selecionado');
                isValid = false;
            }
            
            if (!disciplina) {
                log('‚ùå Disciplina n√£o selecionada');
                isValid = false;
            }
            
            if (!escola) {
                log('‚ùå Escola n√£o preenchida');
                isValid = false;
            }
            
            if (!arquivo) {
                log('‚ùå Arquivo n√£o selecionado');
                isValid = false;
            }
            
            if (isValid) {
                log('‚úÖ Formul√°rio v√°lido!');
                showResults('Formul√°rio validado com sucesso!');
            } else {
                log('‚ùå Formul√°rio inv√°lido - verifique os campos obrigat√≥rios');
            }
        }

        // Mostrar resultados
        function showResults(message) {
            document.getElementById('resultText').textContent = message;
            document.getElementById('results').style.display = 'block';
            log('‚úÖ Resultados exibidos: ' + message);
        }

        // Processar an√°lise real
        async function processAnalysis(formData) {
            log('üîÑ Iniciando processamento...');
            
            const loadingModal = new bootstrap.Modal(document.getElementById('loadingModal'));
            loadingModal.show();
            
            document.getElementById('loadingTitle').textContent = 'Analisando arquivo...';
            document.getElementById('loadingMessage').textContent = 'Processando dados';
            
            // Simular processamento
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            document.getElementById('loadingTitle').textContent = 'Correlacionando...';
            document.getElementById('loadingMessage').textContent = 'Mapeando quest√µes';
            
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            loadingModal.hide();
            
            showResults('An√°lise conclu√≠da! 20 quest√µes processadas com sucesso.');
            log('‚úÖ Processamento conclu√≠do');
        }

        // Configurar eventos quando DOM carregar
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ DOM carregado, configurando eventos...');
            
            const form = document.getElementById('testForm');
            const analyzeBtn = document.getElementById('analyzeBtn');
            
            // Evento do formul√°rio
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                log('üìù Submit do formul√°rio capturado');
                
                validateForm();
                
                const ano = document.getElementById('anoEscolar').value;
                const disciplina = document.getElementById('disciplina').value;
                const escola = document.getElementById('escola').value;
                const arquivo = document.getElementById('fileInput').files[0];
                
                if (ano && disciplina && escola && arquivo) {
                    const formData = new FormData();
                    formData.append('ano', ano);
                    formData.append('disciplina', disciplina);
                    formData.append('escola', escola);
                    formData.append('arquivo', arquivo);
                    
                    processAnalysis(formData);
                } else {
                    log('‚ùå Valida√ß√£o falhou, n√£o iniciando processamento');
                }
            });
            
            // Evento direto do bot√£o
            analyzeBtn.addEventListener('click', function(e) {
                log('üñ±Ô∏è Bot√£o Analisar clicado diretamente');
            });
            
            // Evento do arquivo
            document.getElementById('fileInput').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    log(`üìÅ Arquivo selecionado: ${file.name} (${file.type}, ${file.size} bytes)`);
                } else {
                    log('üìÅ Sele√ß√£o de arquivo cancelada');
                }
            });
            
            log('‚úÖ Todos os eventos configurados');
        });
    </script>
</body>
</html>
